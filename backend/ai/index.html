<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <title>Import Songs into PocketBase</title>
    <style>
      body {
        font-family: Arial, Helvetica, sans-serif;
        padding: 18px;
      }
      input[type="password"] {
        font-family: monospace;
      }
      button {
        padding: 8px 12px;
        margin-top: 8px;
      }
      pre {
        background: #f5f5f5;
        padding: 12px;
        max-height: 400px;
        overflow: auto;
      }
      label {
        display: block;
        margin-bottom: 8px;
      }
    </style>
  </head>
  <body>
    <h2>Import songs ‚Üí PocketBase (fields file & relation left empty)</h2>

    <label>
      Nh·∫≠p Admin Token (v√≠ d·ª•: <code>Bearer eyJ...</code>):
      <input
        type="password"
        id="token"
        style="width: 560px"
        placeholder="Bearer ..."
      />
    </label>

    <label>
      PocketBase URL:
      <input id="pbUrl" value="http://127.0.0.1:8090" style="width: 300px" />
      Collection:
      <input id="collection" value="songs" style="width: 140px" />
    </label>

    <button id="start">B·∫Øt ƒë·∫ßu import</button>
    <button id="stop">D·ª´ng</button>
    <pre id="log">Nh·∫•n "B·∫Øt ƒë·∫ßu import" ƒë·ªÉ ch·∫°y...</pre>

    <script>
      /*
  Import script (browser JS) for songs.
  - Relations (singer_ids, category_ids) are sent as empty arrays.
  - File fields are left empty ('').
  - created_at is computed relative to now to mimic original subtract(Duration(...)).
  - Provide admin token (Bearer ...) before running.
*/

      const logEl = document.getElementById("log");
      const startBtn = document.getElementById("start");
      const stopBtn = document.getElementById("stop");
      let stopRequested = false;

      function daysAgoISO(days) {
        return new Date(Date.now() - days * 24 * 60 * 60 * 1000).toISOString();
      }
      function hoursAgoISO(hours) {
        return new Date(Date.now() - hours * 60 * 60 * 1000).toISOString();
      }

      // === DATA: 56 songs converted from your Dart list.
      // singer_ids and category_ids intentionally empty (you will fill later).
      const songs = [
        {
          song_name: "Ng∆∞·ªùi √Çm Ph·ªß",
          author: "OSAD, VRT",
          total_listens: 9700,
          is_active: true,
          created_at: daysAgoISO(30),
        },
        {
          song_name: "Th·∫±ng ƒêi√™n",
          author: "JustaTee",
          total_listens: 12500,
          is_active: true,
          created_at: daysAgoISO(15),
        },
        {
          song_name: "Th·ªãnh V∆∞·ª£ng Vi·ªát Nam S√°ng Ng·ªùi",
          author: "B√πi Tr∆∞·ªùng Linh",
          total_listens: 6800,
          is_active: true,
          created_at: daysAgoISO(7),
        },
        {
          song_name: "Hoa C·ªè Lau",
          author: "Phong Max",
          total_listens: 8200,
          is_active: true,
          created_at: daysAgoISO(7),
        },
        {
          song_name: "Thanh Xu√¢n",
          author: "DALAB",
          total_listens: 12100,
          is_active: true,
          created_at: daysAgoISO(7),
        },
        {
          song_name: "Ph√°o H·ªìng",
          author: "ƒê·∫°t Long Vinh",
          total_listens: 9200,
          is_active: true,
          created_at: daysAgoISO(5),
        },
        {
          song_name: "L·ªëi Nh·ªè",
          author: "ƒêen V√¢u",
          total_listens: 9000,
          is_active: true,
          created_at: daysAgoISO(4),
        },
        {
          song_name: "Tinh V·ªá",
          author: "MIKC",
          total_listens: 1500,
          is_active: true,
          created_at: daysAgoISO(3),
        },
        {
          song_name: "Nevada",
          author: "Vicetone",
          total_listens: 9000,
          is_active: true,
          created_at: daysAgoISO(2),
        },
        {
          song_name: "ƒê√£ L·ª° Y√™u Em Nhi·ªÅu",
          author: "JustaTee",
          total_listens: 11200,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "M·ªôt Tri·ªáu Like",
          author: "ƒêen V√¢u",
          total_listens: 3500,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "B√†i N√†y Chill Ph·∫øt",
          author: "ƒêen v√¢u",
          total_listens: 7200,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "Hai Tri·ªáu NƒÉm",
          author: "ƒêen V√¢u",
          total_listens: 10500,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "M·∫∑t Tr·ªùi C·ªßa Em",
          author: "Kai ƒêinh",
          total_listens: 9700,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "B√™n Tr√™n T·∫ßng L·∫ßu",
          author: "TƒÉng Duy T√¢n",
          total_listens: 10900,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "G√°c L·∫°i √Çu Lo",
          author: "DABLAB",
          total_listens: 10200,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "T√∫y √Çm",
          author: "Xesi",
          total_listens: 15300,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "V·ªü K·ªãch C·ªßa Em",
          author: "H·ªì Phong An",
          total_listens: 3900,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "C√¢u H·ª©a Ch∆∞a V·∫πn Tr√≤n",
          author: "Ph√°t Huy T4",
          total_listens: 4300,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "S∆°n Th·ªßy Tr√πng M√¢y",
          author: "Anh R·ªìng",
          total_listens: 3500,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "Cao ·ªêc 20",
          author: "B Ray",
          total_listens: 11500,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "Ph·∫£i L√≤ng Con G√°i B·∫øn Tre",
          author: "Phan Ni T·∫•n",
          total_listens: 6324,
          is_active: true,
          created_at: daysAgoISO(2),
        },
        {
          song_name: "Chuy·ªán Ba M√πa M∆∞a",
          author: "Minh K·ª≥, D·∫° C·∫ßm",
          total_listens: 4419,
          is_active: true,
          created_at: daysAgoISO(2),
        },
        {
          song_name: "Em ƒêi Tr√™n C·ªè Non",
          author: "B·∫Øc S∆°n",
          total_listens: 4130,
          is_active: true,
          created_at: daysAgoISO(2),
        },
        {
          song_name: "N·ªëi L·∫°i T√¨nh X∆∞a",
          author: "Ng√¢n Giang, Vinh S·ª≠",
          total_listens: 12081,
          is_active: true,
          created_at: daysAgoISO(2),
        },
        {
          song_name: "Xu√¢n N√†y Con Kh√¥ng V·ªÅ",
          author: "Tr·ªãnh L√¢m Ng√¢n",
          total_listens: 5347,
          is_active: true,
          created_at: daysAgoISO(2),
        },
        {
          song_name: "Mood",
          author: "24kGoldn, Iann Dior",
          total_listens: 2433,
          is_active: true,
          created_at: daysAgoISO(2),
        },
        {
          song_name: "Somebody That I Used To Know",
          author: "Gotye",
          total_listens: 3829,
          is_active: true,
          created_at: daysAgoISO(2),
        },
        {
          song_name: "Cupid UIA",
          author: "Uiia Cat",
          total_listens: 4955,
          is_active: true,
          created_at: daysAgoISO(2),
        },
        {
          song_name: "Summertime Sadness",
          author: "Lana Del Rey",
          total_listens: 4385,
          is_active: true,
          created_at: hoursAgoISO(6),
        },
        {
          song_name: "Ng√¢y Th∆°",
          author: "TƒÉng Duy T√¢n, Phong Max",
          total_listens: 9064,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "ƒê·∫ø V∆∞∆°ng",
          author: "ƒê√¨nh D≈©ng",
          total_listens: 6183,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "T∆∞·ªõng Qu√¢n",
          author: "Nh·∫≠t Phong",
          total_listens: 6738,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "L·∫°c Tr√¥i",
          author: "S∆°n T√πng M-TP",
          total_listens: 12642,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "Khu√¥n M·∫∑t ƒê√°ng Th∆∞∆°ng",
          author: "S∆°n T√πng M-TP",
          total_listens: 7078,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "N∆°i N√†y C√≥ Anh",
          author: "S∆°n T√πng M-TP",
          total_listens: 13066,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "R·ªìi Ta S·∫Ω Ng·∫Øm Ph√°o Hoa C√πng Nhau",
          author: "O.lew",
          total_listens: 10427,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "S√†i G√≤n ƒêau L√≤ng Qu√°",
          author: "H·ª©a Kim Tuy·ªÅn",
          total_listens: 11902,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "N∆∞·ªõc M·∫Øt Em Lau B·∫±ng T√¨nh Y√™u M·ªõi",
          author: "Da LAB",
          total_listens: 10598,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "Ph·∫≠n Duy√™n L·ª° L√†ng",
          author: "Ph√°t Huy T4",
          total_listens: 8115,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "√Ä L√¥i",
          author: "Double2T, Masew",
          total_listens: 6130,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "K√©m Duy√™n",
          author: "Rum",
          total_listens: 9988,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "Xin ƒê·ª´ng Nh·∫•c M√°y",
          author: "B Ray, Trang Yue",
          total_listens: 7145,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "T√°t Nh·∫≠t L√£ng R·ª±c R·ª°",
          author: "L∆∞u T√¢n Khuy√™n",
          total_listens: 3775,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "√Åi N·ªô",
          author: "Masew",
          total_listens: 9227,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "Quan S∆°n T·ª≠u",
          author: "Nh·∫°c Kim Ch·∫•n",
          total_listens: 3315,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "Ngu H·ªÅ Th√°n",
          author: "Ch√∫c H√†",
          total_listens: 3481,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "B·ªì C√¥ng Anh",
          author: "Phong Max",
          total_listens: 8481,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "D·∫° V≈©",
          author: "TƒÉng Duy T√¢n",
          total_listens: 11481,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "An",
          author: "Lil Wuyn",
          total_listens: 8481,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "Young And Beautiful",
          author: "Lana Del Rey",
          total_listens: 12081,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "Walk Thru Fire",
          author: "Vicetone",
          total_listens: 11481,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "V√¨ M·∫π Anh B·∫Øt Chia Tay",
          author: "Ch√¢u ƒêƒÉng Khoa",
          total_listens: 9481,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "S·∫ßu T√≠m Thi·ªáp H·ªìng",
          author: "Ho√†i Linh",
          total_listens: 6481,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "Waiting For Love",
          author: "Avicii",
          total_listens: 9481,
          is_active: true,
          created_at: daysAgoISO(1),
        },
        {
          song_name: "Shape Of You",
          author: "Ed Sheeran",
          total_listens: 10481,
          is_active: true,
          created_at: daysAgoISO(1),
        },
      ];

      // helper to pause between requests
      function sleep(ms) {
        return new Promise((resolve) => setTimeout(resolve, ms));
      }

      async function createRecord(pbUrl, collection, token, body) {
        const res = await fetch(
          `${pbUrl}/api/collections/${collection}/records`,
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: token,
            },
            body: JSON.stringify(body),
          }
        );
        const text = await res.text();
        let data;
        try {
          data = JSON.parse(text);
        } catch (e) {
          data = text;
        }
        return { ok: res.ok, status: res.status, data };
      }

      async function importAll() {
        stopRequested = false;
        const pbUrl = document.getElementById("pbUrl").value.trim();
        const collection = document.getElementById("collection").value.trim();
        const token = document.getElementById("token").value.trim();

        if (!pbUrl || !collection || !token) {
          alert(
            "Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß: PB URL, collection v√† token (Bearer ...)."
          );
          return;
        }

        logEl.textContent = `üöÄ B·∫Øt ƒë·∫ßu import ${songs.length} songs...\n`;
        for (let i = 0; i < songs.length; i++) {
          if (stopRequested) {
            logEl.textContent += "\n‚õî Import ƒë√£ b·ªã d·ª´ng b·ªüi ng∆∞·ªùi d√πng.\n";
            break;
          }
          const s = songs[i];

          // Build body ‚Äî leave relation & file fields empty
          const body = {
            song_name: s.song_name,
            author: s.author,
            total_listens: s.total_listens,
            is_active: s.is_active,
            // relations left empty: send empty arrays so you can fill later
            singer_ids: [],
            category_ids: [],
            // file fields left empty
            song_img: "",
            lrc_file: "",
            lyric_file: "",
            song_file: "",
            // created_at set to mimic original offsets
            created_at: s.created_at,
          };

          try {
            const result = await createRecord(pbUrl, collection, token, body);
            if (result.ok) {
              logEl.textContent += `‚úÖ [${i + 1}/${songs.length}] ${
                s.song_name
              } ‚Äî created (id: ${result.data?.id || "unknown"})\n`;
            } else {
              logEl.textContent += `‚ùå [${i + 1}/${songs.length}] ${
                s.song_name
              } ‚Äî status ${result.status}: ${JSON.stringify(result.data)}\n`;
            }
          } catch (err) {
            logEl.textContent += `‚ö†Ô∏è [${i + 1}/${songs.length}] ${
              s.song_name
            } ‚Äî error: ${err.message}\n`;
          }

          // small delay to avoid rate limits
          await sleep(180);
        }

        if (!stopRequested) logEl.textContent += "\nüéâ Ho√†n t·∫•t import!";
      }

      startBtn.addEventListener("click", () => {
        if (startBtn.disabled) return;
        startBtn.disabled = true;
        importAll().finally(() => (startBtn.disabled = false));
      });

      stopBtn.addEventListener("click", () => {
        stopRequested = true;
      });
    </script>
  </body>
</html>
